name: Debug SSH e Deploy

on:
  workflow_dispatch:   # só dispara manualmente (para testar)
  push:
    branches: ["main"]

jobs:
  debug-ssh:
    name: 🕵️ Testando conexão SSH
    runs-on: ubuntu-latest

    steps:
      - name: ⏳ Testando conexão
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST_ORACLE }}
          username: ubuntu
          key: ${{ secrets.SSH_KEY_ORACLE }}
          port: 22
          script: |
            echo "✅ Consegui conectar no servidor!"
            hostname
            whoami
            uptime

  deploy:
    name: 🚀 Deploy no Oracle
    runs-on: ubuntu-latest
    needs: debug-ssh

    steps:
      - name: 📂 Deploy via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST_ORACLE }}
          username: ubuntu
          key: ${{ secrets.SSH_KEY_ORACLE }}
          port: 22
          script: |
            cd ~/inicial-site-exemplo
            git pull origin main
            sudo systemctl restart frontend-teste.service