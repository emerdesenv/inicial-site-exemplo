name: Debug SSH e Deploy

on:
  workflow_dispatch:   # sÃ³ dispara manualmente (para testar)
  push:
    branches: ["main"]

jobs:
  debug-ssh:
    name: ğŸ•µï¸ Testando conexÃ£o SSH
    runs-on: ubuntu-latest

    steps:
      - name: â³ Testando conexÃ£o
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST_ORACLE }}
          username: ubuntu
          key: ${{ secrets.SSH_KEY_ORACLE }}
          port: 22
          script: |
            echo "âœ… Consegui conectar no servidor!"
            hostname
            whoami
            uptime

  deploy:
    name: ğŸš€ Deploy no Oracle
    runs-on: ubuntu-latest
    needs: debug-ssh

    steps:
      - name: ğŸ“‚ Deploy via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST_ORACLE }}
          username: ubuntu
          key: ${{ secrets.SSH_KEY_ORACLE }}
          port: 22
          script: |
            cd ~/inicial-site-exemplo
            git pull origin main
            sudo systemctl restart frontend-teste.service