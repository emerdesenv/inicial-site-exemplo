name: Debug SSH e Deploy

on:
  workflow_dispatch:   # s√≥ dispara manualmente (para testar)
  push:
    branches: ["main"]

jobs:
  debug-ssh:
    name: üïµÔ∏è Testando conex√£o SSH
    runs-on: ubuntu-latest

    steps:
      - name: ‚è≥ Testando conex√£o
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST_ORACLE }}
          username: opc
          key: ${{ secrets.SSH_KEY_ORACLE }}
          port: 22   # ajuste se sua porta SSH n√£o for 22
          script: |
            echo "‚úÖ Consegui conectar no servidor!"
            hostname
            whoami
            uptime

  deploy:
    name: üöÄ Deploy no Oracle
    runs-on: ubuntu-latest
    needs: debug-ssh   # s√≥ roda se o debug passar

    steps:
      - name: üìÇ Deploy via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST_ORACLE }}
          username: opc
          key: ${{ secrets.SSH_KEY_ORACLE }}
          port: 22
          script: |
            cd ~/projetos/inicial-site-exemplo
            git pull origin main
            sudo systemctl restart meu-site.service
