name: AI PR Review - DevSecOps

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  ai-review:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: AI Code Review (GPT-5)
        uses: anc95/ChatGPT-CodeReview@v1
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          # Modelo que você deseja usar
          model: gpt-5

          # Idioma dos comentários no PR
          language: pt-BR

          # Evita comentários genéricos tipo "LGTM"
          review_comment_lgtm: false

          # Prompt personalizado
          prompt: |
            Você é um revisor técnico de código atuando em um pipeline
            de CI/CD com foco em DevSecOps.

            Analise exclusivamente as alterações presentes neste Pull Request.
            NÃO avalie arquivos ou trechos de código que não foram modificados.

            Durante a revisão, considere:

            1. Qualidade do código
               - Legibilidade e clareza
               - Código duplicado
               - Boas práticas

            2. Segurança
               - Validação de entradas
               - Tratamento de erros
               - Possíveis vulnerabilidades comuns

            3. Manutenibilidade
               - Nomes de variáveis e funções
               - Complexidade desnecessária
               - Sugestões simples de refatoração

            4. Boas práticas DevOps
               - Impacto da alteração no pipeline
               - Risco de regressão
               - Clareza para revisões futuras

            Formato da resposta:
            - Seja claro e objetivo
            - Priorize problemas críticos
            - Separe problemas de sugestões
            - Explique o motivo das recomendações

            Contexto:
            Este Pull Request faz parte de um projeto educacional
            e o objetivo é orientar o desenvolvedor antes do merge.